<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Iguincho - Questionário</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="js/modal-system.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #007bff 0%, #495057 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        /* Subtle background pattern */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.05) 0%, transparent 40%),
                radial-gradient(circle at 75% 75%, rgba(255,255,255,0.03) 0%, transparent 40%);
            pointer-events: none;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 20px;
            text-align: center;
            color: white;
            background: transparent;
        }

        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            padding: 8px;
        }

        .back-button:hover {
            color: white;
            transform: translateY(-50%) translateX(-2px);
        }

        .service-title {
            font-size: 1.8rem;
            font-weight: 300;
            color: white;
            letter-spacing: -0.5px;
            margin-bottom: 4px;
        }

        .service-subtitle {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.7);
            font-weight: 400;
        }

        /* Progress Indicator */
        .progress-container {
            position: fixed;
            top: 100px;
            left: 40px;
            right: 40px;
            z-index: 90;
        }

        .progress-bar {
            width: 100%;
            height: 2px;
            background: rgba(255,255,255,0.2);
            border-radius: 1px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 1px;
            transition: width 0.6s ease;
            width: 0%;
        }

        .progress-text {
            color: rgba(255,255,255,0.7);
            font-size: 0.8rem;
            text-align: center;
            margin-top: 12px;
            font-weight: 400;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            align-items: start;
            justify-content: center;
            padding: 160px 20px 120px;
            position: relative;
            z-index: 1;
        }

        /* Question Container */
        .question-container {
            width: 100%;
            max-width: 400px;
            position: relative;
        }

        .question-card {
            background: transparent;
            padding: 0;
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            display: none;
            text-align: center;
        }

        .question-card.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .question-card.exit {
            opacity: 0;
            transform: translateY(-30px);
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 300;
            color: white;
            margin-bottom: 40px;
            line-height: 1.4;
            letter-spacing: -0.2px;
        }

        /* Answer Buttons */
        .answer-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .answer-btn {
            padding: 18px 24px;
            border: 1px solid rgba(255,255,255,0.3);
            background: transparent;
            color: rgba(255,255,255,0.9);
            border-radius: 0;
            font-size: 1rem;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .answer-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-color: rgba(255,255,255,0.5);
        }

        .answer-btn.selected {
            background: rgba(255,255,255,0.15);
            color: white;
            border-color: white;
        }

        /* Navigation Buttons */
        .navigation-buttons {
            position: fixed;
            bottom: 40px;
            left: 40px;
            right: 40px;
            display: flex;
            gap: 20px;
            z-index: 100;
        }

        .nav-btn {
            flex: 1;
            padding: 16px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 0;
            font-size: 1rem;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: rgba(255,255,255,0.8);
        }

        .nav-btn.prev:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-btn.next {
            background: transparent;
            color: white;
            border-color: white;
        }

        .nav-btn.next:hover {
            background: rgba(255,255,255,0.1);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 2px solid rgba(255,255,255,0.2);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
            font-weight: 300;
            text-align: center;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .question-card {
                padding: 20px;
                margin-bottom: 20px;
            }
            
            .question-text {
                font-size: 1rem;
            }
            
            .answer-btn {
                padding: 14px 20px;
                font-size: 0.9rem;
            }
            
            .navigation-buttons {
                bottom: 20px;
                left: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processando respostas...</div>
    </div>

    <!-- Header -->
    <div class="header">
        <button class="back-button" onclick="goBack()">
            <i class="fas fa-arrow-left"></i> Voltar
        </button>
        <div class="service-title" id="serviceTitle">Carregando serviço...</div>
        <div class="service-subtitle">Responda algumas perguntas</div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Pergunta 1 de 5</div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="question-container" id="questionContainer">
            <!-- Questions will be dynamically loaded here -->
        </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons">
        <button class="nav-btn prev" id="prevBtn" onclick="previousQuestion()" disabled>
            <i class="fas fa-chevron-left"></i> Anterior
        </button>
        <button class="nav-btn next" id="nextBtn" onclick="nextQuestion()" disabled>
            Próxima <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <script>
        // Global variables
        let currentQuestionIndex = 0;
        let questions = [];
        let answers = {};
        let selectedService = '';

        // Service names mapping
        const serviceNames = {
            'guincho': 'Guincho',
            'bateria': 'Socorro Bateria', 
            'pneu': 'Troca de Pneu',
            'chaveiro': 'Chaveiro',
            'mecanico': 'Mecânico',
            'eletricista': 'Eletricista'
        };

        // Standard questions (appears for all services)
        const standardQuestions = [
            {
                id: 'vehicle_type',
                text: 'Qual é o tipo do veículo?',
                options: [
                    { id: 'carro_passeio', text: 'Carro Passeio' },
                    { id: 'sedan_grande', text: 'Sedan Grande Porte' },
                    { id: 'pickup_suv', text: 'Pickup SUV' },
                    { id: 'van_furgao', text: 'Van Furgão' },
                    { id: 'utilitario_carga', text: 'Utilitário Carga' },
                    { id: 'motocicleta', text: 'Motocicleta' },
                    { id: 'outros', text: 'Outros' }
                ]
            },
            {
                id: 'vehicle_armored',
                text: 'Este veículo é blindado? (Para saber o peso do veículo)',
                options: [
                    { id: 'blindado', text: 'É blindado' },
                    { id: 'nao_blindado', text: 'Não é blindado' }
                ]
            }
        ];

        // Service-specific questions
        const serviceSpecificQuestions = {
            'chaveiro': [
                {
                    id: 'chaveiro_situation',
                    text: 'Em que situação você está?',
                    options: [
                        { id: 'chave_trancada', text: 'A chave está trancada dentro do veículo' },
                        { id: 'perdi_chave', text: 'Perdi a chave' }
                    ]
                }
            ],
            'guincho': [
                {
                    id: 'guincho_reason',
                    text: 'Qual o motivo do guincho?',
                    options: [
                        { id: 'acidente', text: 'Acidente' },
                        { id: 'pane_mecanica', text: 'Pane mecânica' },
                        { id: 'nao_liga', text: 'Veículo não liga' },
                        { id: 'outros_motivos', text: 'Outros motivos' }
                    ]
                },
                {
                    id: 'guincho_destination',
                    text: 'Para onde deseja levar o veículo?',
                    options: [
                        { id: 'oficina_escolha', text: 'Oficina de minha escolha' },
                        { id: 'oficina_indicacao', text: 'Oficina por indicação' },
                        { id: 'residencia', text: 'Minha residência' },
                        { id: 'outros_local', text: 'Outro local' }
                    ]
                }
            ],
            'bateria': [
                {
                    id: 'bateria_problem',
                    text: 'Qual o problema com a bateria?',
                    options: [
                        { id: 'descarregada', text: 'Bateria descarregada' },
                        { id: 'nao_funciona', text: 'Bateria não funciona' },
                        { id: 'substituicao', text: 'Preciso substituir' },
                        { id: 'nao_sei', text: 'Não sei o problema' }
                    ]
                }
            ],
            'pneu': [
                {
                    id: 'pneu_problem',
                    text: 'Qual o problema com o pneu?',
                    options: [
                        { id: 'furado', text: 'Pneu furado' },
                        { id: 'murcho', text: 'Pneu murcho' },
                        { id: 'sem_estepe', text: 'Não tenho estepe' },
                        { id: 'nao_consigo_trocar', text: 'Não consigo trocar' }
                    ]
                }
            ],
            'mecanico': [
                {
                    id: 'mecanico_problem',
                    text: 'Qual o problema mecânico?',
                    options: [
                        { id: 'nao_liga', text: 'Veículo não liga' },
                        { id: 'barulho_estranho', text: 'Barulho estranho' },
                        { id: 'superaquecimento', text: 'Superaquecimento' },
                        { id: 'outros_problemas', text: 'Outros problemas' }
                    ]
                }
            ],
            'eletricista': [
                {
                    id: 'eletrica_problem',
                    text: 'Qual o problema elétrico?',
                    options: [
                        { id: 'luzes_nao_funcionam', text: 'Luzes não funcionam' },
                        { id: 'sistema_eletrico', text: 'Problema no sistema elétrico' },
                        { id: 'alternador', text: 'Problema no alternador' },
                        { id: 'outros_eletricos', text: 'Outros problemas elétricos' }
                    ]
                }
            ]
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            getServiceFromUrl();
            buildQuestionsList();
            loadQuestions();
            showCurrentQuestion();
        });

        // Get service from URL parameter
        function getServiceFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            selectedService = urlParams.get('service') || 'guincho';
            
            // Update title
            const serviceName = serviceNames[selectedService] || 'Serviço';
            document.getElementById('serviceTitle').textContent = serviceName;
        }

        // Build complete questions list for the selected service
        function buildQuestionsList() {
            // Start with standard questions
            questions = [...standardQuestions];
            
            // Add service-specific questions if they exist
            if (serviceSpecificQuestions[selectedService]) {
                questions = questions.concat(serviceSpecificQuestions[selectedService]);
            }
        }

        // Load questions into DOM
        function loadQuestions() {
            const container = document.getElementById('questionContainer');
            
            questions.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.id = `question-${index}`;
                
                questionCard.innerHTML = `
                    <div class="question-text">${question.text}</div>
                    <div class="answer-buttons">
                        ${question.options.map(option => `
                            <button class="answer-btn" onclick="selectAnswer('${question.id}', '${option.id}', '${option.text}', this)">
                                ${option.text}
                            </button>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(questionCard);
            });
        }

        // Show current question
        function showCurrentQuestion() {
            // Hide all questions
            const allQuestions = document.querySelectorAll('.question-card');
            allQuestions.forEach(q => {
                q.classList.remove('active');
                q.classList.add('exit');
            });
            
            // Show current question after a brief delay
            setTimeout(() => {
                allQuestions.forEach(q => q.classList.remove('exit'));
                
                if (currentQuestionIndex < questions.length) {
                    const currentCard = document.getElementById(`question-${currentQuestionIndex}`);
                    if (currentCard) {
                        currentCard.classList.add('active');
                    }
                }
                
                updateProgress();
                updateNavigationButtons();
            }, 300);
        }

        // Select answer
        function selectAnswer(questionId, optionId, optionText, buttonElement) {
            // Remove selection from other buttons in this question
            const questionCard = buttonElement.closest('.question-card');
            const allButtons = questionCard.querySelectorAll('.answer-btn');
            allButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Select this button
            buttonElement.classList.add('selected');
            
            // Store answer
            answers[questionId] = {
                optionId: optionId,
                optionText: optionText
            };
            
            // Enable next button
            updateNavigationButtons();
            
            // Auto-advance after 1 second if not last question
            if (currentQuestionIndex < questions.length - 1) {
                setTimeout(() => {
                    nextQuestion();
                }, 1000);
            } else {
                // Last question - show completion option
                setTimeout(() => {
                    completeQuestionnaire();
                }, 1000);
            }
        }

        // Next question
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            }
        }

        // Previous question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }

        // Update progress
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Pergunta ${currentQuestionIndex + 1} de ${questions.length}`;
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Previous button
            prevBtn.disabled = currentQuestionIndex === 0;
            
            // Next button - enabled only if current question is answered
            const currentQuestionId = questions[currentQuestionIndex]?.id;
            const isAnswered = answers[currentQuestionId] !== undefined;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.innerHTML = 'Finalizar <i class="fas fa-check"></i>';
                nextBtn.onclick = completeQuestionnaire;
            } else {
                nextBtn.innerHTML = 'Próxima <i class="fas fa-chevron-right"></i>';
                nextBtn.onclick = nextQuestion;
            }
            
            nextBtn.disabled = !isAnswered;
        }

        // Complete questionnaire
        function completeQuestionnaire() {
            // Check if all questions are answered
            const allAnswered = questions.every(q => answers[q.id] !== undefined);
            
            if (!allAnswered) {
                modalSystem.warning('Por favor, responda todas as perguntas antes de finalizar.');
                return;
            }
            
            // Show loading
            document.getElementById('loadingOverlay').style.display = 'flex';
            
            // Store answers in sessionStorage
            sessionStorage.setItem('questionnaireAnswers', JSON.stringify({
                service: selectedService,
                answers: answers,
                timestamp: Date.now()
            }));
            
            // Simulate processing time
            setTimeout(() => {
                // Redirect to service details page
                window.location.href = `service-details.html?service=${selectedService}`;
            }, 2000);
        }

        // Go back to services
        function goBack() {
            window.location.href = 'services.html';
        }
    </script>
</body>
</html>